<?xml version="1.0"?>

<!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
<!-- iText, a JAVA - PDF library                                      -->
<!-- $Id$         -->
<!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->

<project name="iText.compile" default="help">
	
	<property file="local.properties" />
	<property file="${user.home}/.ant.properties" />
	<property file=".ant.properties" />
	
	<path id="itext.classpath">
	    <pathelement location="${itext.bin}"/>
	    <pathelement path="${itext.lib}/bcmail-${bc.jdk}-${bc.version}.jar"/>
	    <pathelement path="${itext.lib}/bcprov-${bc.jdk}-${bc.version}.jar"/>
	</path>

	<path id="itext.examples.classpath">
	    <pathelement location="${itext.bin}"/>
	    <pathelement location="${jfreechart.jar}"/>
	    <pathelement location="${jcommon.jar}"/>
	    <pathelement location="${servlet.jar}"/>
	    <pathelement path="${itext.lib}/bcmail-${bc.jdk}-${bc.version}.jar"/>
	    <pathelement path="${itext.lib}/bcprov-${bc.jdk}-${bc.version}.jar"/>
	</path>
	
    <path id="itext.test.classpath">
        <pathelement location="${itext.jar}"/>
        <pathelement location="${itext.bin.examples}"/>
        <pathelement location="${itext.bin.test}"/>
        <pathelement location="${itext.lib}/iTextAsian.jar"/>
        <pathelement location="${jfreechart.jar}"/>
        <pathelement location="${jcommon.jar}"/>
        <pathelement location="${servlet.jar}"/>
        <pathelement location="${junit.jar}"/>
        <pathelement path="${itext.lib}/bcmail-${bc.jdk}-${bc.version}.jar"/>
        <pathelement path="${itext.lib}/bcprov-${bc.jdk}-${bc.version}.jar"/>
    </path>

    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
    <!-- Help                                                             -->
    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->

    <target name="help" description="--> shows the help screen">
        <echo>COMPILING AND JARRING THE CODE (compile.xml)</echo>
        <echo>ant compile: compiles iText</echo>
        <echo>ant compile.debug: compiles iText and allows you to debug the code</echo>
        <echo>ant jar: compiles and jars iText</echo>
        <echo>ant jar.debug: compiles for debugging and jars iText</echo>
        <echo />
	</target>

    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
    <!-- Compiling the code                                               -->
    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->

    <target name="compile" description="--> compiles the iText code">
        <mkdir dir="${itext.bin}" />
        <javac source="1.4" target="1.4" srcdir="${itext.src}" destdir="${itext.bin}">
    	<classpath refid="itext.classpath"/>
    	</javac>
    </target>

    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
    <!-- Compiling the code for debugging                                 -->
    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->

    <target name="compile.debug" description="--> compiles the iText code for debugging">
        <mkdir dir="${itext.bin}" />
        <javac source="1.4" target="1.4" srcdir="${itext.src}" destdir="${itext.bin}" listfiles="yes" debug="true" debuglevel="lines,vars,source">
        	<classpath refid="itext.classpath"/>
       	</javac>
    </target>

    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
    <!-- Compiling the examples                                           -->
    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->

    <target name="compile.examples" depends="compile" description="--> compiles the iText examples">
        <mkdir dir="${itext.bin.examples}" />

        <javac source="1.4" target="1.4" srcdir="${itext.src.examples}" destdir="${itext.bin.examples}">
    	<classpath refid="itext.examples.classpath"/>
    	</javac>
    </target>

    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
    <!-- Compiling and running the tests                                  -->
    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->

    <target name="test" depends="jar, compile.examples" description="--> compiles and runs the iText tests">
        <mkdir dir="${itext.bin.test}" />

        <javac source="1.5" target="1.5" srcdir="${itext.src.test}" destdir="${itext.bin.test}">
            <classpath refid="itext.test.classpath"/>
        </javac>

        <mkdir dir="${itext.bin.data}" />
        <mkdir dir="${itext.reports}/xml" />
        <copy flatten="yes" todir="${itext.bin.data}">
            <fileset dir="${itext.src.examples}">
                <include name="**/*.bmp"/>
                <include name="**/*.gif"/>
                <include name="**/*.jpg"/>
                <include name="**/*.otf"/>
                <include name="**/*.pdf"/>
                <include name="**/*.png"/>
                <include name="**/*.tif"/>
                <include name="**/*.wmf"/>
                <include name="**/*.xfdf"/>
                <include name="**/*.xml"/>
            </fileset>
        </copy>
        <junit printsummary="yes" showoutput="no" filtertrace="no" haltonfailure="yes" dir="${itext.bin.data}">
            <sysproperty key="java.awt.headless" value="true"/>
            <classpath refid="itext.test.classpath" />
            <batchtest fork="yes" todir="${itext.reports}/xml">
                <fileset dir="${itext.src.test}">
                    <include name="**/*Test.java" />
                </fileset>
            </batchtest>
            <formatter type="xml" />
        </junit>
        <junitreport todir="${itext.reports}/xml">
            <fileset dir="${itext.reports}/xml">
                <include name="TEST-*.xml" />
            </fileset>
            <report format="frames" todir="${itext.reports}/junit" />
        </junitreport>
    </target>

    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
    <!-- Jarring the code                                                 -->
    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->

    <target name="make.jar" description="--> makes a jarfile from the iText code">
        <mkdir dir="${itext.bin}/com/lowagie/text/pdf/fonts" />
        <copy todir="${itext.bin}/com/lowagie/text/pdf/fonts" overwrite="yes">
            <fileset dir="${itext.src}/com/lowagie/text/pdf/fonts">
                <include name="**/*.afm"/>
                <include name="**/*.html"/>
            </fileset>
        </copy>
        <copy todir="${itext.bin}/com/lowagie/text/" overwrite="yes">
            <fileset dir="${itext.src}/com/lowagie/text/">
                <include name="**/*.txt"/>
            </fileset>
        </copy>
        <jar jarfile="${itext.jar}" basedir="${itext.bin}" excludes="com/lowagie/examples/**,**/*.cmap,**/*.properties,com/lowagie/text/pdf/fonts/cmaps/**">
            <manifest>
                <attribute name="Main-Class" value="com.lowagie.tools.ToolboxAvailable"/>
                <attribute name="Class-Path" value="toolbox.jar bcmail-${bc.jdk}-${bc.version}.jar bcprov-${bc.jdk}-${bc.version}.jar"/>
            </manifest>
        </jar>
    </target>

    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
    <!-- Compiling and Jarring the code                                   -->
	<!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
	
    <target name="jar"  depends="compile, make.jar" description="--> makes a jarfile from the iText code" />

    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
    <!-- Jarring the code (debug)                                         -->
    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
	
    <target name="jar.debug"  depends="compile.debug, make.jar" description="--> makes a jarfile from the iText code" />
    
	<!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
    <!-- Signing the jar                                                  -->
    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
	
    <target name="check-keystore" >
        <condition property="keystore-exists">
            <available file="${itext.keystore.filename}" type="file"/>
        </condition>
    </target>
 
    <target name="keystore" depends="check-keystore" unless="keystore-exists">
        <genkey
            keystore="${itext.keystore.filename}"
            storepass="${itext.keystore.password}"
            alias="${itext.keystore.alias}"
            storetype="${itext.keystore.storetype}"
            dname="${itext.keystore.dname}"
        />
    </target>
 
    <target name="sign.jar" depends="keystore">
        <signjar
            jar="${itext.jar}"
            keystore="${itext.keystore.filename}"
            storepass="${itext.keystore.password}"
            alias="${itext.keystore.alias}"
            storetype="${itext.keystore.storetype}"
        />
    </target>
</project>
